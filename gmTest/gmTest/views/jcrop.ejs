<!--<html>-->
<style type="text/css">  
 #preview, .img, img  
 {  
   width:500px;  
   height:auto;
 }  
#preview  
{  
  border:1px solid #000;  
}  
</style>  





     <div id="preview"></div> 
     <div style="width:100px;height:100px;overflow:hidden;">
         <img src="" id="preview2" />
     </div>

     <form method="post" enctype="multipart/form-data" action="/jcrop">
      <label>X1 <input type="text" size="4" id="x" name="x" /></label>
      <label>Y1 <input type="text" size="4" id="y" name="y" /></label>
      <label>W <input type="text" size="4" id="w" name="w" /></label>
      <label>H <input type="text" size="4" id="hg" name="hg" /></label>
      <label>X2 <input type="text" size="4" id="x2" name="x2" /></label>
      <label>Y2 <input type="text" size="4" id="y2" name="y2" /></label>


      <input type="file" onchange="preview(this)" id="file" name="img"/>  
       <button class="btn" id="upload">上传头像</button>
    </form>
 



     <script type="text/javascript">  

     function preview(file)  
     {  
        var prevDiv = document.getElementById('preview');  
        var prevDiv2 = document.getElementById('preview2');  
       if (file.files && file.files[0])  
       {  
             var reader = new FileReader();  
             reader.onload = function(evt){  
                 prevDiv.innerHTML = '<img id="cropbox" src="' + evt.target.result + '" />';  
                 prevDiv2.src=evt.target.result ;
                 console.log(evt.target);

                 jQuery('#cropbox').Jcrop({
                    onChange: showPreview,
                    onSelect: showPreview,
                    setSelect: [ 100, 100, 200, 200 ],
                    aspectRatio: 1
                  });

            }    
          reader.readAsDataURL(file.files[0]);  
        }else{  
           prevDiv.innerHTML = '<div class="img" id="cropbox" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\'' + file.value + '\'"></div>';  
             console.log(file.value);
            prevDiv2.src=file.value ;

             jQuery('#cropbox').Jcrop({
              onChange: showPreview,
              onSelect: showPreview,
              setSelect: [ 100, 100, 200, 200 ],
              aspectRatio: 1
            });

       }  
     }  


      function showPreview(coords)
      {
        jQuery('#x').val(coords.x);
        jQuery('#y').val(coords.y);
        jQuery('#w').val(coords.w);
        jQuery('#hg').val(coords.h);
        jQuery('#x2').val(coords.x2);
        jQuery('#y2').val(coords.y2);

        if (parseInt(coords.w) > 0)
        {
          var rx = 100 / coords.w;
          var ry = 100 / coords.h;

          jQuery('#preview2').css({
            width: Math.round(rx * 500) + 'px',
            height: Math.round(ry * 370) + 'px',
            marginLeft: '-' + Math.round(rx * coords.x) + 'px',
            marginTop: '-' + Math.round(ry * coords.y) + 'px'
          });
        }
      }

     </script>  
 